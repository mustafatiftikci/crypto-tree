<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoTree WASM Demo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f8f9fa; color: #333; }
        h1 { color: #2c3e50; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #2980b9; }
        pre { background: #f1f1f1; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .label { font-weight: bold; color: #555; }
    </style>
</head>
<body>
    <h1>üå≥ CryptoTree WASM Demo</h1>
    <p><em>Search and verify blockchain transactions in your browser ‚Äî no server needed.</em></p>

    <div class="card">
        <h2>Insert Transaction</h2>
        <div>
            <label class="label">Tx ID:</label> <input type="text" id="txId" value="tx_001" style="width: 100px;" />
            <label class="label">From:</label> <input type="text" id="from" value="Alice" style="width: 100px;" />
            <label class="label">To:</label> <input type="text" id="to" value="Bob" style="width: 100px;" />
            <label class="label">Amount:</label> <input type="number" id="amount" value="100" style="width: 80px;" />
            <label class="label">Timestamp:</label> <input type="number" id="timestamp" value="1640995200" style="width: 120px;" />
            <button onclick="insertTx()">Insert</button>
        </div>
    </div>

    <div class="card">
        <h2>Search Transaction</h2>
        <div>
            <label class="label">Tx ID to search:</label> <input type="text" id="searchId" value="tx_001" style="width: 150px;" />
            <button onclick="searchTx()">Search</button>
            <button onclick="clearOutput()">Clear</button>
        </div>
    </div>

    <div class="card">
        <h2>Get Proof of Inclusion</h2>
        <div>
            <label class="label">Tx ID for proof:</label> <input type="text" id="proofId" value="tx_001" style="width: 150px;" />
            <button onclick="getProof()">Get Proof</button>
        </div>
    </div>

    <div class="card">
        <h2>Tree Status</h2>
        <div><span class="label">Size:</span> <span id="size">0</span></div>
        <div><span class="label">Merkle Root:</span> <span id="merkleRoot">-</span></div>
        <div><span class="label">Integrity:</span> <span id="integrity">-</span></div>
        <button onclick="verifyIntegrity()">Verify Integrity</button>
    </div>

    <div class="card">
        <h2>Output</h2>
        <pre id="output" style="white-space: pre-wrap; font-family: monospace; background: #f1f1f1; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto;"></pre>
    </div>

    <script type="module">
        import init, { CryptoTreeWasm } from './pkg/crypto_tree_wasm.js';

        async function initApp() {
            await init();
            window.tree = new CryptoTreeWasm();
            updateStatus();
        }

        function updateStatus() {
            document.getElementById('size').textContent = window.tree.len();
            document.getElementById('merkleRoot').textContent = window.tree.merkle_root();
            document.getElementById('integrity').textContent = window.tree.verify_integrity() ? 
                '<span class="success">‚úì Valid</span>' : '<span class="error">‚úó Invalid</span>';
        }

        function insertTx() {
            const id = document.getElementById('txId').value;
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const amount = parseInt(document.getElementById('amount').value);
            const timestamp = parseInt(document.getElementById('timestamp').value) || null;

            const inserted = window.tree.insert(id, from, to, amount, timestamp);
            log(`‚úÖ Inserted: ${id} (${inserted ? 'new' : 'duplicate'})`);
            updateStatus();
        }

        function searchTx() {
            const id = document.getElementById('searchId').value;
            const tx = window.tree.search(id);
            if (tx) {
                log(`üîç Found: ${JSON.stringify(tx, null, 2)}`);
            } else {
                log(`‚ùå Not found: ${id}`);
            }
        }

        function getProof() {
            const id = document.getElementById('proofId').value;
            const proof = window.tree.get_proof_of_inclusion(id);
            if (proof) {
                log(`üìã Proof for ${id}:\n${JSON.stringify(proof, null, 2)}`);
            } else {
                log(`‚ùå No proof found for ${id}`);
            }
        }

        function verifyIntegrity() {
            const valid = window.tree.verify_integrity();
            document.getElementById('integrity').innerHTML = valid ? 
                '<span class="success">‚úì Valid</span>' : '<span class="error">‚úó Invalid</span>';
            log(valid ? 'üõ°Ô∏è Tree integrity: ‚úÖ Valid' : 'üõ°Ô∏è Tree integrity: ‚ùå Invalid');
        }

        function clearOutput() {
            document.getElementById('output').textContent = '';
        }

        function log(message) {
            const output = document.getElementById('output');
            output.textContent += message + '\n\n';
            output.scrollTop = output.scrollHeight;
        }

        // Initialize
        initApp();
    </script>
</body>
</html>